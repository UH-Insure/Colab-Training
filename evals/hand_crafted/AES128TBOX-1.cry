type GF28 = [8]

gf28Mult : GF28 -> GF28 -> GF28
gf28Mult x y = pmod (pmult x y) <| x^^8 + x^^4 + x^^3 + x + 1 |>

gf28Pow : GF28 -> [8] -> GF28
gf28Pow n k =
  if k == 0 then 1
  else
    (if (k && 1) == 1 then gf28Mult n w
     else w
       where v = gf28Pow n (k >> 1)
             w = gf28Mult v v)

gf28Inverse : GF28 -> GF28
gf28Inverse x = gf28Pow x 254

aesAffine : [8] -> [8]
aesAffine b = c
  where
        rol : {n} (fin n) => [n] -> [n]
    rol x = x <<< 1  
            c = b ^ (b <<< 1) ^ (b <<< 2) ^ (b <<< 3) ^ (b <<< 4) ^ 0x63

aesSBox : [8] -> [8]
aesSBox x = aesAffine y
  where
        y = if x == 0x00 then 0x00 else gf28Inverse x

aesSBoxTable : [16][16][8]
aesSBoxTable = [ [ aesSBox (r * 16 + c) | c <- [0..15]] |  r <- [0..15]]

property cell00 = aesSBoxTable @ 0 @ 0 == 0x63